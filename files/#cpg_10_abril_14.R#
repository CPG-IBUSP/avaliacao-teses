library(reshape)
library(Hmisc)

fichas <- upData(fichas,
       labels=c(aluno="identificador do aluno (numero aleatorio)",
           ano.defesa="Ano da defesa da tese/dissertacao",
           programa="Programa de pos-graduacao",
           titul="Curso",
           titul.2="Titulacao",
           prazo.dep="Prazo regimental para deposito da tese/dissertacao",
           tempo.dep="Tempo de deposito",
           tempo.def="Tempo de titulacao",
           avaliador="categoria do avaliador",
           estrato="quantil de qualidade relativa da tese, segundo o avaliador",
           estrato.n="quantil de qualidade em scala de 1 (=10%) até 4 (=50%)",
           impacto="impacto potencial da melhor publicacao resultante",
           impacto.n="impacto potencial em escala de 1 (alto) a 4 (não publicável)",
           nota.tese="soma de indicacoes de excelencia nos 10 quesitos a seguir",
           redacao="excelencia na redacao",
           contextualiz="excelencia na contextualizacao teorica",
           objetivos="excelencia nos objetivos: bem definidos e condizentes com o titulo pleiteado",
           hip.claras="excelencia nas hipoteses: perguntas e/ou hipoteses sao claras e explicitas",
           originalidade="excelencia na originalidade e na relevancia do trabalho",
           metodos="excelencia nos metodos: bem descritos e adequados para responder a(s) pergunta(s)",
           analises="excelencia nas analises: bem descritas e adequadas para responder a(s) pergunta(s)",
           resultados="excelencia nos resultados: bem apresentados e respondem a(s) pergunta(s).",
           discussao="excelencia na discussao: solida e fortemente alicercada nos resultados obtidos.",
           literatura="excelencia na literatura usada: adequada e atualizada"
           ),
                 units=c(tempo.dep="unidades de 30 dias", tempo.def="unidades de 30 dias")
                 )

## Modelo glmer para efeito de tipo de avaliador
library(lme4)
library(bbmle)
tmp <- subset(fichas, ano.defesa>2012)
m0 <- glmer(discussao~(1|aluno), data=tmp, family=binomial)
m1 <-  glmer(discussao~avaliador+(1|aluno), data=tmp, family=binomial)
m2 <- glmer(discussao~avaliador+titul.2+(1|aluno), data=tmp, family=binomial)
m3 <- glmer(discussao~avaliador+programa+(1|aluno), data=tmp, family=binomial)
m4 <- glmer(discussao~avaliador*programa+(1|aluno), data=tmp, family=binomial)
AICtab(m0,m1,m2,m3,m4)

tmp2 <- melt(tmp, id.vars=c("aluno","avaliador"), measure.vars="discussao")
tmp3 <- cast(tmp2, value~aluno|variable)
